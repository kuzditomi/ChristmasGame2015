var Cm2k15;
(function (Cm2k15) {
    var GameTile = (function () {
        function GameTile(row, col, size, element) {
            //console.log('gametile constructor:' + row + ',' + col);
            this.element = element;
            this.initialize(row, col, size);
        }
        GameTile.prototype.initialize = function (row, col, size) {
            this.element.style.top = row * size + 'px';
            this.element.style.left = col * size + 'px';
            this.element.style.width = this.element.style.height = size + 'px';
            this.element.className = 'tile';
        };
        GameTile.prototype.Reset = function () {
            this.element.innerText = "";
        };
        GameTile.prototype.Set = function (text) {
            this.element.innerText = text;
        };
        GameTile.prototype.SetVisited = function (visited) {
            this.element.className = 'tile ' + (visited ? '' : 'dark');
        };
        return GameTile;
    })();
    Cm2k15.GameTile = GameTile;
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="GameTile.ts"/>
var Cm2k15;
(function (Cm2k15) {
    var GameMap = (function () {
        function GameMap(map, state) {
            // constants
            this.tileCount = 9;
            console.log('gamemap constructor');
            // initialize game state
            this.state = state;
            // create tile views
            var mapWidth = map.clientWidth;
            var tileSize = mapWidth / this.tileCount;
            this.tiles = [];
            for (var i = 0; i < this.tileCount; i++) {
                this.tiles.push([]);
                for (var j = 0; j < this.tileCount; j++) {
                    var element = document.createElement('div');
                    this.tiles[i][j] = new Cm2k15.GameTile(i, j, tileSize, element);
                    map.appendChild(element);
                }
            }
        }
        GameMap.prototype.Display = function () {
            var middle = Math.floor(this.tileCount / 2);
            var left = this.state.Player.X < (middle) ? 0
                : this.state.Player.X > (this.state.Width - middle) ? this.state.Width - this.tileCount
                    : this.state.Player.X - middle;
            var top = this.state.Player.Y < (middle) ? 0
                : this.state.Player.Y > (this.state.Height - middle) ? this.state.Height - this.tileCount
                    : this.state.Player.Y - middle;
            for (var i = 0; i < this.tileCount; i++) {
                for (var j = 0; j < this.tileCount; j++) {
                    var tile = this.tiles[i][j];
                    var tileState = this.state.Tiles[left + j][top + i];
                    if (top + i == this.state.Player.Y && left + j == this.state.Player.X) {
                        tile.Set('[x]');
                    }
                    else {
                        tile.Reset();
                    }
                    tile.SetVisited(tileState.Visited);
                }
            }
        };
        return GameMap;
    })();
    Cm2k15.GameMap = GameMap;
})(Cm2k15 || (Cm2k15 = {}));
var Cm2k15;
(function (Cm2k15) {
    var GameMapState = (function () {
        function GameMapState(width, height) {
            this.Width = width;
            this.Height = height;
            this.Tiles = [];
            for (var i = 0; i < height; i++) {
                this.Tiles[i] = [];
                for (var j = 0; j < width; j++) {
                    this.Tiles[i][j] = new TileState();
                }
            }
            this.Player = new PlayerState();
            this.Player.X = 2;
            this.Player.Y = 2;
            this.Tiles[this.Player.X][this.Player.Y].Visited = true;
        }
        return GameMapState;
    })();
    Cm2k15.GameMapState = GameMapState;
    var TileState = (function () {
        function TileState() {
            this.Visited = false;
        }
        return TileState;
    })();
    var PlayerState = (function () {
        function PlayerState() {
        }
        PlayerState.prototype.Move = function (direction) {
            switch (direction) {
                case 'up':
                    this.Y--;
                    break;
                case 'down':
                    this.Y++;
                    break;
                case 'left':
                    this.X--;
                    break;
                case 'right':
                    this.X++;
                    break;
                default:
                    return 'Move where?';
            }
            return "You have moved " + direction + ".";
        };
        return PlayerState;
    })();
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="GameMap.ts"/>
/// <reference path="GameMapState.ts"/>
var Cm2k15;
(function (Cm2k15) {
    var Game = (function () {
        function Game(map, input, message) {
            var _this = this;
            console.log('game constructor');
            this.state = new Cm2k15.GameMapState(20, 20);
            this.commands = {};
            this.map = new Cm2k15.GameMap(map, this.state);
            this.map.Display();
            this.messageElement = message;
            input.onkeydown = function (e) {
                if (e.keyCode == 13) {
                    var command = input.value;
                    input.value = '';
                    _this.onCommand.call(_this, command);
                    return false;
                }
            };
            this.registerCommands();
        }
        Game.prototype.registerCommands = function () {
            this.registerCommand('move', this.moveCommand);
        };
        Game.prototype.registerCommand = function (key, command) {
            this.commands[key] = command.bind(this);
        };
        Game.prototype.onCommand = function (text) {
            var parts = text.split(" ");
            var command = parts[0];
            var args = parts.length > 1 ? parts.splice(1, parts.length - 1) : [];
            if (this.commands[command]) {
                var result = this.commands[command].apply(this, args);
                this.message(result);
            }
            else {
                this.messageNoCommand();
            }
        };
        Game.prototype.moveCommand = function (direction) {
            var result = this.state.Player.Move(direction);
            this.state.Tiles[this.state.Player.X][this.state.Player.Y].Visited = true;
            this.map.Display();
            return result;
        };
        Game.prototype.message = function (text) {
            if (text) {
                var row = document.createElement('div');
                row.innerText = text;
                this.messageElement.appendChild(row);
                this.messageElement.scrollTop = this.messageElement.scrollHeight - this.messageElement.clientHeight;
            }
        };
        Game.prototype.messageNoCommand = function () {
            var messages = [
                "what?",
                "uhm...",
                "nope",
                "i dont think so"
            ];
            var message = messages[Math.floor(Math.random() * messages.length)];
            this.message(message);
        };
        return Game;
    })();
    Cm2k15.Game = Game;
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="Game.ts"/>
var Cm2k15;
(function (Cm2k15) {
    var commandInput = document.getElementById('command');
    var map = document.getElementById('map');
    var message = document.getElementById('message');
    var game = new Cm2k15.Game(map, commandInput, message);
})(Cm2k15 || (Cm2k15 = {}));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdhbWVUaWxlLnRzIiwiR2FtZU1hcC50cyIsIkdhbWVNYXBTdGF0ZS50cyIsIkdhbWUudHMiLCJhcHAudHMiXSwibmFtZXMiOlsiQ20yazE1IiwiQ20yazE1LkdhbWVUaWxlIiwiQ20yazE1LkdhbWVUaWxlLmNvbnN0cnVjdG9yIiwiQ20yazE1LkdhbWVUaWxlLmluaXRpYWxpemUiLCJDbTJrMTUuR2FtZVRpbGUuUmVzZXQiLCJDbTJrMTUuR2FtZVRpbGUuU2V0IiwiQ20yazE1LkdhbWVUaWxlLlNldFZpc2l0ZWQiLCJDbTJrMTUuR2FtZU1hcCIsIkNtMmsxNS5HYW1lTWFwLmNvbnN0cnVjdG9yIiwiQ20yazE1LkdhbWVNYXAuRGlzcGxheSIsIkNtMmsxNS5HYW1lTWFwU3RhdGUiLCJDbTJrMTUuR2FtZU1hcFN0YXRlLmNvbnN0cnVjdG9yIiwiQ20yazE1LlRpbGVTdGF0ZSIsIkNtMmsxNS5UaWxlU3RhdGUuY29uc3RydWN0b3IiLCJDbTJrMTUuUGxheWVyU3RhdGUiLCJDbTJrMTUuUGxheWVyU3RhdGUuY29uc3RydWN0b3IiLCJDbTJrMTUuUGxheWVyU3RhdGUuTW92ZSIsIkNtMmsxNS5HYW1lIiwiQ20yazE1LkdhbWUuY29uc3RydWN0b3IiLCJDbTJrMTUuR2FtZS5yZWdpc3RlckNvbW1hbmRzIiwiQ20yazE1LkdhbWUucmVnaXN0ZXJDb21tYW5kIiwiQ20yazE1LkdhbWUub25Db21tYW5kIiwiQ20yazE1LkdhbWUubW92ZUNvbW1hbmQiLCJDbTJrMTUuR2FtZS5tZXNzYWdlIiwiQ20yazE1LkdhbWUubWVzc2FnZU5vQ29tbWFuZCJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBTyxNQUFNLENBNkJaO0FBN0JELFdBQU8sTUFBTSxFQUFDLENBQUM7SUFDYkE7UUFHRUMsa0JBQW1CQSxHQUFXQSxFQUFFQSxHQUFXQSxFQUFFQSxJQUFZQSxFQUFFQSxPQUF1QkE7WUFDaEZDLHlEQUF5REE7WUFDekRBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNB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QUNBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLGVBQVFBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLFFBQVFBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO29CQUN6REEsR0FBR0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7Z0JBQzdCQSxDQUFDQTtZQUNMQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVNRCx5QkFBT0EsR0FBZEE7WUFDSUUsSUFBSUEsTUFBTUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFFNUNBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO2tCQUN2Q0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsQ0FBQ0EsU0FBU0E7c0JBQ3JGQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxHQUFHQSxNQUFNQSxDQUFDQTtZQUVuQ0EsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7a0JBQ3RDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQTtzQkFDdkZBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLEdBQUdBLE1BQU1BLENBQUNBO1lBRW5DQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxFQUFFQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxFQUFFQSxFQUFFQSxDQUFDQTtnQkFDdENBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBLEVBQUVBLEVBQUVBLENBQUNBO29CQUN0Q0EsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQzVCQSxJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFFcERBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLEdBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLElBQUlBLEdBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO3dCQUNoRUEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7b0JBQ3BCQSxDQUFDQTtvQkFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7d0JBQ0pBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO29CQUNqQkEsQ0FBQ0E7b0JBRURBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLFNBQVNBLENBQUNBLE9BQU9BLENBQUNB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O2dCQUNQQSxRQUFRQTtnQkFDUkEsTUFBTUE7Z0JBQ05BLGlCQUFpQkE7YUFDbEJBLENBQUNBO1lBRUZBLElBQUlBLE9BQU9BLEdBQUdBLFFBQVFBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLEVBQUVBLEdBQUdBLFFBQVFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ3BFQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFDSFAsV0FBQ0E7SUFBREEsQ0E5RUFqQixBQThFQ2lCLElBQUFqQjtJQTlFWUEsV0FBSUEsT0E4RWhCQSxDQUFBQTtBQUNIQSxDQUFDQSxFQWhGTSxNQUFNLEtBQU4sTUFBTSxRQWdGWjtBQ25GRCwrQkFBK0I7QUFDL0IsSUFBTyxNQUFNLENBS1o7QUFMRCxXQUFPLE1BQU0sRUFBQyxDQUFDO0lBQ2JBLElBQUlBLFlBQVlBLEdBQXdCQSxRQUFRQSxDQUFDQSxjQUFjQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtJQUMzRUEsSUFBSUEsR0FBR0EsR0FBbUJBLFFBQVFBLENBQUNBLGNBQWNBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3pEQSxJQUFJQSxPQUFPQSxHQUFtQkEsUUFBUUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0E7SUFDakVBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLEVBQUVBLFlBQVlBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO0FBQ3pEQSxDQUFDQSxFQUxNLE1BQU0sS0FBTixNQUFNLFFBS1oiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlIENtMmsxNSB7XHJcbiAgZXhwb3J0IGNsYXNzIEdhbWVUaWxlIHtcclxuICAgIHByaXZhdGUgZWxlbWVudDogSFRNTERpdkVsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgc2l6ZTogbnVtYmVyLCBlbGVtZW50OiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAvL2NvbnNvbGUubG9nKCdnYW1ldGlsZSBjb25zdHJ1Y3RvcjonICsgcm93ICsgJywnICsgY29sKTtcclxuICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgdGhpcy5pbml0aWFsaXplKHJvdyxjb2wsc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgc2l6ZTogbnVtYmVyKXtcclxuICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHJvdypzaXplICsgJ3B4JztcclxuICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBjb2wqc2l6ZSArICdweCc7XHJcbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBzaXplICsgJ3B4JztcclxuICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9ICd0aWxlJztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgUmVzZXQoKXtcclxuICAgICAgdGhpcy5lbGVtZW50LmlubmVyVGV4dCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFNldCh0ZXh0OiBzdHJpbmcpe1xyXG4gICAgICB0aGlzLmVsZW1lbnQuaW5uZXJUZXh0ID0gdGV4dDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgU2V0VmlzaXRlZCh2aXNpdGVkOiBib29sZWFuKXtcclxuICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9ICd0aWxlICcgKyAodmlzaXRlZCA/ICcnIDogJ2RhcmsnKTtcclxuICAgIH1cclxuICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiR2FtZVRpbGUudHNcIi8+XHJcblxyXG5tb2R1bGUgQ20yazE1IHtcclxuICAgIGV4cG9ydCBjbGFzcyBHYW1lTWFwIHtcclxuICAgICAgICAvLyBjb25zdGFudHNcclxuICAgICAgICB0aWxlQ291bnQgPSA5O1xyXG5cclxuICAgICAgICAvLyB2aWV3c1xyXG4gICAgICAgIHRpbGVzOiBHYW1lVGlsZVtdW107XHJcblxyXG4gICAgICAgIC8vIG1vZGVsXHJcbiAgICAgICAgc3RhdGU6IEdhbWVNYXBTdGF0ZTtcclxuXHJcbiAgICAgICAgcHVibGljIGNvbnN0cnVjdG9yKG1hcDpIVE1MRGl2RWxlbWVudCwgc3RhdGU6IEdhbWVNYXBTdGF0ZSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZ2FtZW1hcCBjb25zdHJ1Y3RvcicpO1xyXG5cclxuICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSBnYW1lIHN0YXRlXHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcclxuXHJcbiAgICAgICAgICAgIC8vIGNyZWF0ZSB0aWxlIHZpZXdzXHJcbiAgICAgICAgICAgIHZhciBtYXBXaWR0aCA9IG1hcC5jbGllbnRXaWR0aDtcclxuICAgICAgICAgICAgdmFyIHRpbGVTaXplID0gbWFwV2lkdGggLyB0aGlzLnRpbGVDb3VudDtcclxuICAgICAgICAgICAgdGhpcy50aWxlcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGlsZUNvdW50OyBpKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGlsZXMucHVzaChbXSk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMudGlsZUNvdW50OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbGVzW2ldW2pdID0gbmV3IEdhbWVUaWxlKGksIGosIHRpbGVTaXplLCBlbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBtYXAuYXBwZW5kQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHB1YmxpYyBEaXNwbGF5KCkge1xyXG4gICAgICAgICAgICB2YXIgbWlkZGxlID0gTWF0aC5mbG9vcih0aGlzLnRpbGVDb3VudCAvIDIpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGxlZnQgPSB0aGlzLnN0YXRlLlBsYXllci5YIDwgKG1pZGRsZSkgPyAwXHJcbiAgICAgICAgICAgICAgICA6IHRoaXMuc3RhdGUuUGxheWVyLlggPiAodGhpcy5zdGF0ZS5XaWR0aCAtIG1pZGRsZSkgPyB0aGlzLnN0YXRlLldpZHRoIC0gdGhpcy50aWxlQ291bnRcclxuICAgICAgICAgICAgICAgIDogdGhpcy5zdGF0ZS5QbGF5ZXIuWCAtIG1pZGRsZTtcclxuXHJcbiAgICAgICAgICAgIHZhciB0b3AgPSB0aGlzLnN0YXRlLlBsYXllci5ZIDwgKG1pZGRsZSkgPyAwXHJcbiAgICAgICAgICAgICAgICA6IHRoaXMuc3RhdGUuUGxheWVyLlkgPiAodGhpcy5zdGF0ZS5IZWlnaHQgLSBtaWRkbGUpID8gdGhpcy5zdGF0ZS5IZWlnaHQgLSB0aGlzLnRpbGVDb3VudFxyXG4gICAgICAgICAgICAgICAgOiB0aGlzLnN0YXRlLlBsYXllci5ZIC0gbWlkZGxlO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRpbGVDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMudGlsZUNvdW50OyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGlsZSA9IHRoaXMudGlsZXNbaV1bal07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRpbGVTdGF0ZSA9IHRoaXMuc3RhdGUuVGlsZXNbbGVmdCArIGpdW3RvcCArIGldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9wK2kgPT0gdGhpcy5zdGF0ZS5QbGF5ZXIuWSAmJiBsZWZ0K2ogPT0gdGhpcy5zdGF0ZS5QbGF5ZXIuWCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aWxlLlNldCgnW3hdJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5SZXNldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgdGlsZS5TZXRWaXNpdGVkKHRpbGVTdGF0ZS5WaXNpdGVkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsIm1vZHVsZSBDbTJrMTUge1xyXG4gICAgZXhwb3J0IGNsYXNzIEdhbWVNYXBTdGF0ZSB7XHJcbiAgICAgICAgcHVibGljIFRpbGVzOiBUaWxlU3RhdGVbXVtdO1xyXG4gICAgICAgIHB1YmxpYyBQbGF5ZXI6IFBsYXllclN0YXRlO1xyXG5cclxuICAgICAgICBwdWJsaWMgV2lkdGg6IG51bWJlcjtcclxuICAgICAgICBwdWJsaWMgSGVpZ2h0OiBudW1iZXI7XHJcblxyXG4gICAgICAgIGNvbnN0cnVjdG9yKHdpZHRoOm51bWJlciwgaGVpZ2h0Om51bWJlcikge1xyXG4gICAgICAgICAgICB0aGlzLldpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgICAgIHRoaXMuSGVpZ2h0ID0gaGVpZ2h0O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5UaWxlcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLlRpbGVzW2ldID0gW107XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLlRpbGVzW2ldW2pdID0gbmV3IFRpbGVTdGF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLlBsYXllciA9IG5ldyBQbGF5ZXJTdGF0ZSgpO1xyXG4gICAgICAgICAgICB0aGlzLlBsYXllci5YID0gMjtcclxuICAgICAgICAgICAgdGhpcy5QbGF5ZXIuWSA9IDI7XHJcblxyXG4gICAgICAgICAgICB0aGlzLlRpbGVzW3RoaXMuUGxheWVyLlhdW3RoaXMuUGxheWVyLlldLlZpc2l0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBUaWxlU3RhdGUge1xyXG4gICAgICAgIHB1YmxpYyBWaXNpdGVkOiBib29sZWFuO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAgICAgdGhpcy5WaXNpdGVkID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNsYXNzIFBsYXllclN0YXRlIHtcclxuICAgICAgICBwdWJsaWMgWDogbnVtYmVyO1xyXG4gICAgICAgIHB1YmxpYyBZOiBudW1iZXI7XHJcblxyXG4gICAgICAgIHB1YmxpYyBNb3ZlKGRpcmVjdGlvbjogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ZLS07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkb3duJzpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLlkrKztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2xlZnQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuWC0tO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuWCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJ01vdmUgd2hlcmU/JztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIFwiWW91IGhhdmUgbW92ZWQgXCIgKyBkaXJlY3Rpb24gKyBcIi5cIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiR2FtZU1hcC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkdhbWVNYXBTdGF0ZS50c1wiLz5cclxuXHJcbm1vZHVsZSBDbTJrMTUge1xyXG4gIGV4cG9ydCBjbGFzcyBHYW1lIHtcclxuICAgIHByaXZhdGUgbWFwOiBHYW1lTWFwO1xyXG4gICAgcHJpdmF0ZSBzdGF0ZTogR2FtZU1hcFN0YXRlO1xyXG4gICAgcHJpdmF0ZSBjb21tYW5kczogeyBba2V5OiBzdHJpbmddOiAoYXJncykgPT4gYW55IH07XHJcblxyXG4gICAgLy8gdWlcclxuICAgIHByaXZhdGUgbWVzc2FnZUVsZW1lbnQ6IEhUTUxEaXZFbGVtZW50O1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihtYXA6IEhUTUxEaXZFbGVtZW50LCBpbnB1dDogSFRNTFRleHRBcmVhRWxlbWVudCwgbWVzc2FnZTogSFRNTERpdkVsZW1lbnQpIHtcclxuICAgICAgY29uc29sZS5sb2coJ2dhbWUgY29uc3RydWN0b3InKTtcclxuXHJcbiAgICAgIHRoaXMuc3RhdGUgPSBuZXcgR2FtZU1hcFN0YXRlKDIwLDIwKTtcclxuICAgICAgdGhpcy5jb21tYW5kcyA9IHt9O1xyXG4gICAgICB0aGlzLm1hcCA9IG5ldyBHYW1lTWFwKG1hcCwgdGhpcy5zdGF0ZSk7XHJcbiAgICAgIHRoaXMubWFwLkRpc3BsYXkoKTtcclxuICAgICAgdGhpcy5tZXNzYWdlRWxlbWVudCA9IG1lc3NhZ2U7XHJcblxyXG4gICAgICBpbnB1dC5vbmtleWRvd24gPSAoZTogS2V5Ym9hcmRFdmVudCkgPT4ge1xyXG4gICAgICAgIGlmIChlLmtleUNvZGUgPT0gMTMpIHtcclxuICAgICAgICAgIHZhciBjb21tYW5kID0gaW5wdXQudmFsdWU7XHJcbiAgICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xyXG4gICAgICAgICAgdGhpcy5vbkNvbW1hbmQuY2FsbCh0aGlzLCBjb21tYW5kKTtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0aGlzLnJlZ2lzdGVyQ29tbWFuZHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyQ29tbWFuZHMoKSB7XHJcbiAgICAgIHRoaXMucmVnaXN0ZXJDb21tYW5kKCdtb3ZlJywgdGhpcy5tb3ZlQ29tbWFuZCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSByZWdpc3RlckNvbW1hbmQoa2V5OiBzdHJpbmcsIGNvbW1hbmQ6IChhcmdzKSA9PiBhbnkpIHtcclxuICAgICAgdGhpcy5jb21tYW5kc1trZXldID0gY29tbWFuZC5iaW5kKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgb25Db21tYW5kKHRleHQpIHtcclxuICAgICAgdmFyIHBhcnRzID0gdGV4dC5zcGxpdChcIiBcIik7XHJcbiAgICAgIHZhciBjb21tYW5kID0gcGFydHNbMF07XHJcbiAgICAgIHZhciBhcmdzID0gcGFydHMubGVuZ3RoID4gMSA/IHBhcnRzLnNwbGljZSgxLCBwYXJ0cy5sZW5ndGggLSAxKSA6IFtdO1xyXG4gICAgICBpZiAodGhpcy5jb21tYW5kc1tjb21tYW5kXSkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmNvbW1hbmRzW2NvbW1hbmRdLmFwcGx5KHRoaXMsIGFyZ3MpO1xyXG4gICAgICAgIHRoaXMubWVzc2FnZShyZXN1bHQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMubWVzc2FnZU5vQ29tbWFuZCgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtb3ZlQ29tbWFuZChkaXJlY3Rpb24pIHtcclxuICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuc3RhdGUuUGxheWVyLk1vdmUoZGlyZWN0aW9uKTtcclxuICAgICAgdGhpcy5zdGF0ZS5UaWxlc1t0aGlzLnN0YXRlLlBsYXllci5YXVt0aGlzLnN0YXRlLlBsYXllci5ZXS5WaXNpdGVkID0gdHJ1ZTtcclxuICAgICAgdGhpcy5tYXAuRGlzcGxheSgpO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIG1lc3NhZ2UodGV4dDogc3RyaW5nKSB7XHJcbiAgICAgIGlmICh0ZXh0KSB7XHJcbiAgICAgICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHJvdy5pbm5lclRleHQgPSB0ZXh0O1xyXG5cclxuICAgICAgICB0aGlzLm1lc3NhZ2VFbGVtZW50LmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgICAgICAgdGhpcy5tZXNzYWdlRWxlbWVudC5zY3JvbGxUb3AgPSB0aGlzLm1lc3NhZ2VFbGVtZW50LnNjcm9sbEhlaWdodCAtIHRoaXMubWVzc2FnZUVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBtZXNzYWdlTm9Db21tYW5kKCkge1xyXG4gICAgICB2YXIgbWVzc2FnZXMgPSBbXHJcbiAgICAgICAgXCJ3aGF0P1wiLFxyXG4gICAgICAgIFwidWhtLi4uXCIsXHJcbiAgICAgICAgXCJub3BlXCIsXHJcbiAgICAgICAgXCJpIGRvbnQgdGhpbmsgc29cIlxyXG4gICAgICBdO1xyXG5cclxuICAgICAgdmFyIG1lc3NhZ2UgPSBtZXNzYWdlc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtZXNzYWdlcy5sZW5ndGgpXTtcclxuICAgICAgdGhpcy5tZXNzYWdlKG1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxufSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHYW1lLnRzXCIvPlxyXG5tb2R1bGUgQ20yazE1IHtcclxuICB2YXIgY29tbWFuZElucHV0ID0gPEhUTUxUZXh0QXJlYUVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1hbmQnKTtcclxuICB2YXIgbWFwID0gPEhUTUxEaXZFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKTtcclxuICB2YXIgbWVzc2FnZSA9IDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZScpO1xyXG4gIHZhciBnYW1lID0gbmV3IENtMmsxNS5HYW1lKG1hcCwgY29tbWFuZElucHV0LCBtZXNzYWdlKTtcclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
