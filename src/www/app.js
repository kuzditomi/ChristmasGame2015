var Cm2k15;
(function (Cm2k15) {
    var GameTile = (function () {
        function GameTile(row, col, size, element) {
            //console.log('gametile constructor:' + row + ',' + col);
            this.element = element;
            this.initialize(row, col, size);
        }
        GameTile.prototype.initialize = function (row, col, size) {
            this.element.style.top = row * size + 'px';
            this.element.style.left = col * size + 'px';
            this.element.style.width = this.element.style.height = size + 'px';
            this.element.className = 'tile';
        };
        GameTile.prototype.Reset = function () {
            this.element.innerText = "";
        };
        GameTile.prototype.Set = function (text) {
            this.element.innerText = text;
        };
        return GameTile;
    })();
    Cm2k15.GameTile = GameTile;
})(Cm2k15 || (Cm2k15 = {}));
var Cm2k15;
(function (Cm2k15) {
    var GamePlayer = (function () {
        function GamePlayer() {
            console.log('player constructor');
            this.x = 2;
            this.y = 2;
        }
        GamePlayer.prototype.GetPosition = function () {
            return {
                x: this.x,
                y: this.y
            };
        };
        GamePlayer.prototype.Move = function (direction) {
            switch (direction) {
                case 'up':
                    this.y--;
                    break;
                case 'down':
                    this.y++;
                    break;
                case 'left':
                    this.x--;
                    break;
                case 'right':
                    this.x++;
                    break;
            }
        };
        return GamePlayer;
    })();
    Cm2k15.GamePlayer = GamePlayer;
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="GameTile.ts"/>
/// <reference path="GamePlayer.ts"/>
var Cm2k15;
(function (Cm2k15) {
    var GameMap = (function () {
        function GameMap(map, player) {
            this.tileCount = 8;
            console.log('gamemap constructor');
            var mapWidth = map.clientWidth;
            var tileSize = mapWidth / this.tileCount;
            this.player = player;
            this.tiles = [];
            for (var i = 0; i < this.tileCount; i++) {
                this.tiles.push([]);
                for (var j = 0; j < this.tileCount; j++) {
                    var element = document.createElement('div');
                    this.tiles[i][j] = new Cm2k15.GameTile(i, j, tileSize, element);
                    map.appendChild(element);
                }
            }
        }
        GameMap.prototype.Display = function () {
            var playerpos = this.player.GetPosition();
            for (var i = 0; i < this.tileCount; i++) {
                for (var j = 0; j < this.tileCount; j++) {
                    if (i == playerpos.y && j == playerpos.x) {
                        this.tiles[i][j].Set('[x]');
                    }
                    else {
                        this.tiles[i][j].Reset();
                    }
                }
            }
        };
        return GameMap;
    })();
    Cm2k15.GameMap = GameMap;
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="GameMap.ts"/>
/// <reference path="GamePlayer.ts"/>
var Cm2k15;
(function (Cm2k15) {
    var Game = (function () {
        function Game(map, input) {
            var _this = this;
            console.log('game constructor');
            this.commands = {};
            this.player = new Cm2k15.GamePlayer();
            this.map = new Cm2k15.GameMap(map, this.player);
            this.map.Display();
            input.onkeydown = function (e) {
                if (e.keyCode == 13) {
                    var command = input.value;
                    input.value = '';
                    _this.onCommand.call(_this, command);
                    return false;
                }
            };
            this.registerCommands();
        }
        Game.prototype.registerCommands = function () {
            this.registerCommand('move', this.moveCommand);
        };
        Game.prototype.registerCommand = function (key, command) {
            this.commands[key] = command.bind(this);
        };
        Game.prototype.onCommand = function (text) {
            var parts = text.split(" ");
            var command = parts[0];
            var args = parts.length > 1 ? parts.splice(1, parts.length - 1) : [];
            if (this.commands[command]) {
                this.commands[command].apply(this, args);
            }
        };
        Game.prototype.moveCommand = function (direction) {
            this.player.Move(direction);
            this.map.Display();
        };
        return Game;
    })();
    Cm2k15.Game = Game;
})(Cm2k15 || (Cm2k15 = {}));
/// <reference path="Game.ts"/>
var commandInput = document.getElementById('command');
var map = document.getElementById('map');
var game = new Cm2k15.Game(map, commandInput);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkdhbWVUaWxlLnRzIiwiR2FtZVBsYXllci50cyIsIkdhbWVNYXAudHMiLCJHYW1lLnRzIiwiYXBwLnRzIl0sIm5hbWVzIjpbIkNtMmsxNSIsIkNtMmsxNS5HYW1lVGlsZSIsIkNtMmsxNS5HYW1lVGlsZS5jb25zdHJ1Y3RvciIsIkNtMmsxNS5HYW1lVGlsZS5pbml0aWFsaXplIiwiQ20yazE1LkdhbWVUaWxlLlJlc2V0IiwiQ20yazE1LkdhbWVUaWxlLlNldCIsIkNtMmsxNS5HYW1lUGxheWVyIiwiQ20yazE1LkdhbWVQbGF5ZXIuY29uc3RydWN0b3IiLCJDbTJrMTUuR2FtZVBsYXllci5HZXRQb3NpdGlvbiIsIkNtMmsxNS5HYW1lUGxheWVyLk1vdmUiLCJDbTJrMTUuR2FtZU1hcCIsIkNtMmsxNS5HYW1lTWFwLmNvbnN0cnVjdG9yIiwiQ20yazE1LkdhbWVNYXAuRGlzcGxheSIsIkNtMmsxNS5HYW1lIiwiQ20yazE1LkdhbWUuY29uc3RydWN0b3IiLCJDbTJrMTUuR2FtZS5yZWdpc3RlckNvbW1hbmRzIiwiQ20yazE1LkdhbWUucmVnaXN0ZXJDb21tYW5kIiwiQ20yazE1LkdhbWUub25Db21tYW5kIiwiQ20yazE1LkdhbWUubW92ZUNvbW1hbmQiXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sTUFBTSxDQXlCWjtBQXpCRCxXQUFPLE1BQU0sRUFBQyxDQUFDO0lBQ2JBO1FBR0VDLGtCQUFtQkEsR0FBV0EsRUFBRUEsR0FBV0EsRUFBRUEsSUFBWUEsRUFBRUEsT0FBdUJBO1lBQ2hGQyx5REFBeURBO1lBQ3pEQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtZQUN2QkEsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsR0FBR0EsRUFBQ0EsR0FBR0EsRUFBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDaENBLENBQUNBO1FBRU9ELDZCQUFVQSxHQUFsQkEsVUFBbUJBLEdBQVdBLEVBQUVBLEdBQVdBLEVBQUVBLElBQVlBO1lBQ3ZERSxJQUFJQSxDQUFD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biAgZXhwb3J0IGNsYXNzIEdhbWVUaWxlIHtcclxuICAgIHByaXZhdGUgZWxlbWVudDogSFRNTERpdkVsZW1lbnQ7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgc2l6ZTogbnVtYmVyLCBlbGVtZW50OiBIVE1MRGl2RWxlbWVudCkge1xyXG4gICAgICAvL2NvbnNvbGUubG9nKCdnYW1ldGlsZSBjb25zdHJ1Y3RvcjonICsgcm93ICsgJywnICsgY29sKTtcclxuICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgdGhpcy5pbml0aWFsaXplKHJvdyxjb2wsc2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0aWFsaXplKHJvdzogbnVtYmVyLCBjb2w6IG51bWJlciwgc2l6ZTogbnVtYmVyKXtcclxuICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLnRvcCA9IHJvdypzaXplICsgJ3B4JztcclxuICAgICAgdGhpcy5lbGVtZW50LnN0eWxlLmxlZnQgPSBjb2wqc2l6ZSArICdweCc7XHJcbiAgICAgIHRoaXMuZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMuZWxlbWVudC5zdHlsZS5oZWlnaHQgPSBzaXplICsgJ3B4JztcclxuICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTmFtZSA9ICd0aWxlJztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgUmVzZXQoKXtcclxuICAgICAgdGhpcy5lbGVtZW50LmlubmVyVGV4dCA9IFwiXCI7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIFNldCh0ZXh0OiBzdHJpbmcpe1xyXG4gICAgICB0aGlzLmVsZW1lbnQuaW5uZXJUZXh0ID0gdGV4dDtcclxuICAgIH1cclxuICB9XHJcbn0iLCJtb2R1bGUgQ20yazE1IHtcclxuICBleHBvcnQgY2xhc3MgR2FtZVBsYXllciB7XHJcbiAgICBwcml2YXRlIHg6IG51bWJlcjtcclxuICAgIHByaXZhdGUgeTogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgY29uc29sZS5sb2coJ3BsYXllciBjb25zdHJ1Y3RvcicpO1xyXG4gICAgICB0aGlzLnggPSAyO1xyXG4gICAgICB0aGlzLnkgPSAyO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBHZXRQb3NpdGlvbigpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB4OiB0aGlzLngsXHJcbiAgICAgICAgeTogdGhpcy55XHJcbiAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIE1vdmUoZGlyZWN0aW9uOiBzdHJpbmcpIHtcclxuICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgICBjYXNlICd1cCc6XHJcbiAgICAgICAgICB0aGlzLnktLTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Rvd24nOlxyXG4gICAgICAgICAgdGhpcy55Kys7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlICdsZWZ0JzpcclxuICAgICAgICAgIHRoaXMueC0tO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAncmlnaHQnOlxyXG4gICAgICAgICAgdGhpcy54Kys7XHJcbiAgICAgICAgICBicmVhazsgXHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiR2FtZVRpbGUudHNcIi8+XHJcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHYW1lUGxheWVyLnRzXCIvPlxyXG5tb2R1bGUgQ20yazE1IHtcclxuICBleHBvcnQgY2xhc3MgR2FtZU1hcCB7XHJcbiAgICB0aWxlQ291bnQgPSA4O1xyXG4gICAgdGlsZXM6IEdhbWVUaWxlW11bXTtcclxuICAgIHBsYXllcjogR2FtZVBsYXllcjtcclxuXHJcbiAgICBwdWJsaWMgY29uc3RydWN0b3IobWFwOiBIVE1MRGl2RWxlbWVudCwgcGxheWVyOiBHYW1lUGxheWVyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdnYW1lbWFwIGNvbnN0cnVjdG9yJyk7XHJcblxyXG4gICAgICB2YXIgbWFwV2lkdGggPSBtYXAuY2xpZW50V2lkdGg7XHJcbiAgICAgIHZhciB0aWxlU2l6ZSA9IG1hcFdpZHRoIC8gdGhpcy50aWxlQ291bnQ7XHJcblxyXG4gICAgICB0aGlzLnBsYXllciA9IHBsYXllcjtcclxuICAgICAgdGhpcy50aWxlcyA9IFtdO1xyXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudGlsZUNvdW50OyBpKyspIHsgIFxyXG4gICAgICAgIHRoaXMudGlsZXMucHVzaChbXSk7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnRpbGVDb3VudDsgaisrKSB7XHJcbiAgICAgICAgICB2YXIgZWxlbWVudCA9IDxIVE1MRGl2RWxlbWVudD5kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgIHRoaXMudGlsZXNbaV1bal0gPSBuZXcgR2FtZVRpbGUoaSwgaiwgdGlsZVNpemUsIGVsZW1lbnQpO1xyXG4gICAgICAgICAgbWFwLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBEaXNwbGF5KCkge1xyXG4gICAgICB2YXIgcGxheWVycG9zID0gdGhpcy5wbGF5ZXIuR2V0UG9zaXRpb24oKTtcclxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRpbGVDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB0aGlzLnRpbGVDb3VudDsgaisrKSB7XHJcbiAgICAgICAgICBpZiAoaSA9PSBwbGF5ZXJwb3MueSAmJiBqID09IHBsYXllcnBvcy54KSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlsZXNbaV1bal0uU2V0KCdbeF0nKTtcclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudGlsZXNbaV1bal0uUmVzZXQoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbn0iLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiR2FtZU1hcC50c1wiLz5cclxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIkdhbWVQbGF5ZXIudHNcIi8+XHJcblxyXG5tb2R1bGUgQ20yazE1IHtcclxuICBleHBvcnQgY2xhc3MgR2FtZSB7XHJcblxyXG4gICAgcHJpdmF0ZSBtYXA6IEdhbWVNYXA7XHJcbiAgICBwcml2YXRlIHBsYXllcjogR2FtZVBsYXllcjtcclxuICAgIHByaXZhdGUgY29tbWFuZHM6IHsgW2tleTpzdHJpbmddIDogKGFyZ3MpID0+IGFueSB9O1xyXG5cclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcihtYXA6IEhUTUxEaXZFbGVtZW50LCBpbnB1dDogSFRNTFRleHRBcmVhRWxlbWVudCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnZ2FtZSBjb25zdHJ1Y3RvcicpO1xyXG5cclxuICAgICAgdGhpcy5jb21tYW5kcyA9IHt9O1xyXG4gICAgICB0aGlzLnBsYXllciA9IG5ldyBHYW1lUGxheWVyKCk7XHJcbiAgICAgIHRoaXMubWFwID0gbmV3IEdhbWVNYXAobWFwLCB0aGlzLnBsYXllcik7XHJcbiAgICAgIHRoaXMubWFwLkRpc3BsYXkoKTtcclxuXHJcbiAgICAgIGlucHV0Lm9ua2V5ZG93biA9IChlOiBLZXlib2FyZEV2ZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAxMykge1xyXG4gICAgICAgICAgdmFyIGNvbW1hbmQgPSBpbnB1dC52YWx1ZTtcclxuICAgICAgICAgIGlucHV0LnZhbHVlID0gJyc7XHJcbiAgICAgICAgICB0aGlzLm9uQ29tbWFuZC5jYWxsKHRoaXMsIGNvbW1hbmQpO1xyXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIHRoaXMucmVnaXN0ZXJDb21tYW5kcygpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgcmVnaXN0ZXJDb21tYW5kcygpIHtcclxuICAgICAgdGhpcy5yZWdpc3RlckNvbW1hbmQoJ21vdmUnLCB0aGlzLm1vdmVDb21tYW5kKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlZ2lzdGVyQ29tbWFuZChrZXk6IHN0cmluZywgY29tbWFuZDogKGFyZ3MpID0+IGFueSkge1xyXG4gICAgICB0aGlzLmNvbW1hbmRzW2tleV0gPSBjb21tYW5kLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvbkNvbW1hbmQodGV4dCkge1xyXG4gICAgICB2YXIgcGFydHMgPSB0ZXh0LnNwbGl0KFwiIFwiKTtcclxuICAgICAgdmFyIGNvbW1hbmQgPSBwYXJ0c1swXTtcclxuICAgICAgdmFyIGFyZ3MgPSBwYXJ0cy5sZW5ndGggPiAxID8gcGFydHMuc3BsaWNlKDEsIHBhcnRzLmxlbmd0aCAtIDEpIDogW107XHJcbiAgICAgIGlmICh0aGlzLmNvbW1hbmRzW2NvbW1hbmRdKSB7XHJcbiAgICAgICAgdGhpcy5jb21tYW5kc1tjb21tYW5kXS5hcHBseSh0aGlzLCBhcmdzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgbW92ZUNvbW1hbmQoZGlyZWN0aW9uKSB7XHJcbiAgICAgIHRoaXMucGxheWVyLk1vdmUoZGlyZWN0aW9uKTtcclxuICAgICAgdGhpcy5tYXAuRGlzcGxheSgpO1xyXG4gICAgfVxyXG4gIH1cclxufSIsIi8vLyA8cmVmZXJlbmNlIHBhdGg9XCJHYW1lLnRzXCIvPlxyXG5cclxudmFyIGNvbW1hbmRJbnB1dCA9IDxIVE1MVGV4dEFyZWFFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tYW5kJyk7XHJcbnZhciBtYXAgPSA8SFRNTERpdkVsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xyXG5cclxudmFyIGdhbWUgPSBuZXcgQ20yazE1LkdhbWUobWFwLCBjb21tYW5kSW5wdXQpO1xyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
